<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lgcns.wcs.kurly.repository.OrdmadeNotfullyRepository">
   
  <select id="selectOrdmadeNotfully" resultType="com.lgcns.wcs.kurly.dto.OrdmadeNotfullyData">
  	/* [OrdmadeNotfullyMapper.xml] selectOrdmadeNotfully */
    SELECT 
		OD.INVOICE_NO         AS invoiceNo,
		OD.INVOICE_SEQ        AS invoiceSeq,
		OD.WAREHOUSE_KEY      AS warehouseKey,
		OD.GROUP_NO           AS groupNo,
		OD.WORK_BATCH_NO      AS workBatchNo,
		OD.PICKING_WAVE_NO      AS pickingWaveNo,
		OD.SKU_CODE           AS skuCode,
		OD.SKU_NAME           AS skuName,
		OD.SKU_SUB_NAME       AS skuSubName,
		OD.QTY_NOTFULLY       AS qtyNotfully,
		OD.SHIP_ORDER_KEY       AS shipOrderKey,
		OD.SHIP_ORDER_ITEM_SEQ       AS shipOrderItemSeq,
		TO_CHAR(SYSDATE, 'YYYYMMDD') AS insertedDate,
		TO_CHAR(SYSDATE, 'HH24MISS') AS insertedTime,
		OH.CREATED_USER AS insertedUser
 	FROM  o_wcs.TB_QPS_ORDER_HDR OH ,
		  o_wcs.TB_QPS_ORDER_DTL OD   
 	WHERE  OH.INVOICE_NO = OD.INVOICE_NO
 	  AND  OD.ORDMADE_NOTFULLY_TYPE   IN ( 'NOTFULLY', 'PARTSHIP' )
 	  AND  OD.NOTFULLY_IF_YN      = 'N' 
  </select>

  <update id="updateOrdmadeNotfully" parameterType="Map">
    /* [OrdmadeNotfullyMapper.xml] updateOrdmadeNotfully */
  	UPDATE o_wcs.TB_QPS_ORDER_DTL
		SET
			NOTFULLY_IF_YN  = #{notfullyIfYn} ,
			NOTFULLY_IF_YMD = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') ,
			NOTFULLY_IF_RET_CODE = #{notfullyIfRetCode} ,
			NOTFULLY_IF_RET_MESSAGE = #{notfullyIfRetMessage} ,
			MODIFIED_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD') ,
			MODIFIED_TIME = TO_CHAR(SYSDATE, 'HH24MISS') ,
			MODIFIED_USER = #{modifiedUser}
	WHERE INVOICE_NO = #{invoiceNo}
	  AND INVOICE_SEQ = #{invoiceSeq}
  </update>

</mapper>